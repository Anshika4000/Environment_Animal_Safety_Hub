<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoLife | Animal First Aid</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <link rel="icon" type="image/png" href="/envirnoment-logo.png">

    <!-- Page Styles -->
    <link rel="stylesheet" href="../../css/pages/animal-safety/animal-first-aid.css">

    <!-- Component Styles -->
    <link rel="stylesheet" href="../css/components/footer.css" />
    <link rel="stylesheet" href="../css/components/navbar.css" />
    <link rel="stylesheet" href="../css/global/utilities.css" />
</head>

<body>

<div id="cursor-container"></div>
<script src="../../js/components/loadComponents.js"></script>
<div id="navbar-container"></div>

<!-- Theme Toggle -->
<div class="theme-toggle">
    <button class="theme-btn" id="themeToggle">
        <i class="fas fa-moon"></i>
        <span>Dark Mode</span>
    </button>
</div>

<div class="main-container">

    <section data-aos="fade-up">
        <h2>ü©∫ Animal First Aid</h2>
        <p class="subtitle">Select an animal type to see recommended first aid tips in an interactive way.</p>

        <div class="animal-types">
            <button class="animal-type-btn active" data-type="bird">Birds</button>
            <button class="animal-type-btn" data-type="mammal">Mammals</button>
            <button class="animal-type-btn" data-type="reptile">Reptiles</button>
            <button class="animal-type-btn" data-type="amphibian">Amphibians</button>
        </div>

        <div class="first-aid-grid" id="firstAidGrid"></div>
    </section>

    <!-- Assessment Section -->
    <div class="assessment-container">
        <div class="assessment-section" data-aos="fade-up">

            <div class="assessment-header">
                <h3>ü©∫ Emergency Symptom Assessment</h3>
                <p>Select all symptoms you observe to get immediate guidance</p>
            </div>

            <div class="symptom-checklist" id="symptomChecklist">
                <!-- (UNCHANGED symptom checkboxes section kept exactly same) -->
            </div>

            <div class="emergency-level" id="emergencyLevel">
                <div class="level-header">
                    <div class="level-icon" id="levelIcon">üö®</div>
                    <div>
                        <div class="level-title" id="levelTitle">Emergency Level</div>
                        <p id="levelDescription">Based on your selected symptoms</p>
                    </div>
                </div>
                <p id="levelInstructions">Follow the priority actions below immediately.</p>
            </div>

            <div class="action-steps" id="actionSteps">
                <h4>üìã Priority Actions</h4>
                <div id="stepsContainer"></div>
            </div>

            <div class="vet-guidance" id="vetGuidance">
                <h4><i class="fas fa-phone-alt"></i> When to Call a Vet Immediately</h4>
                <p id="vetInstructions"></p>
                <div class="assessment-buttons">
                    <button class="assessment-btn primary" onclick="findNearestVet()">
                        <i class="fas fa-map-marker-alt"></i> Find Nearest Emergency Vet
                    </button>
                    <button class="assessment-btn secondary" onclick="prepareForVetVisit()">
                        <i class="fas fa-briefcase-medical"></i> How to Prepare for Vet Visit
                    </button>
                </div>
            </div>

            <div class="assessment-buttons">
                <button class="assessment-btn primary" onclick="assessSymptoms()">
                    <i class="fas fa-stethoscope"></i> Assess Selected Symptoms
                </button>
                <button class="assessment-btn secondary" onclick="resetAssessment()">
                    <i class="fas fa-redo"></i> Reset Assessment
                </button>
            </div>

        </div>
    </div>

    <div class="footer-note" data-aos="fade-up">
        <p>‚ö†Ô∏è Important: This tool provides general first aid guidance only. Always consult a qualified veterinarian.</p>
        <p style="margin-top:0.5rem;font-size:0.8rem;">
            ¬© 2024 EcoLife Animal First Aid | Dark Mode: <span id="themeStatus">Off</span>
        </p>
    </div>

</div>

<!-- Footer -->
<div id="footer-placeholder"></div>
<script src="../../js/components/footer-loader.js"></script>
<script src="js/components/navbar-loader.js"></script>

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="../../js/pages/animal-safety/animal-first-aid.js"></script>

<script>
AOS.init();

/* ===========================
   FIXED PRIORITY SORTING LOGIC
   =========================== */

function assessSymptoms() {

    const selectedSymptoms = [];
    document.querySelectorAll('.symptom-item input:checked')
        .forEach(input => selectedSymptoms.push(input.value));

    if (selectedSymptoms.length === 0) {
        alert('Please select at least one symptom');
        return;
    }

    let highestLevel = 'monitor';

    selectedSymptoms.forEach(symptom => {
        const level = symptomData[symptom]?.level;
        if (level === 'critical') highestLevel = 'critical';
        else if (level === 'urgent' && highestLevel !== 'critical')
            highestLevel = 'urgent';
    });

    const emergencyLevel = document.getElementById('emergencyLevel');
    emergencyLevel.className = `emergency-level show ${highestLevel}`;

    const stepsContainer = document.getElementById('stepsContainer');
    stepsContainer.innerHTML = '';

    const allSteps = [];

    selectedSymptoms.forEach(symptom => {
        if (symptomData[symptom]) {
            symptomData[symptom].steps.forEach(step => {
                allSteps.push({
                    step,
                    priority:
                        symptomData[symptom].level === 'critical' ? 1 :
                        symptomData[symptom].level === 'urgent' ? 2 : 3
                });
            });
        }
    });

    // FIXED: Proper priority sorting
    allSteps.sort((a, b) => a.priority - b.priority);

    const seen = new Set();
    const uniqueSteps = [];

    allSteps.forEach(item => {
        if (!seen.has(item.step)) {
            seen.add(item.step);
            uniqueSteps.push(item.step);
        }
    });

    uniqueSteps.forEach((step, index) => {
        const div = document.createElement('div');
        div.className = 'step';
        div.innerHTML = `
            <div class="step-number">${index + 1}</div>
            <div>${step}</div>
        `;
        stepsContainer.appendChild(div);
    });

    document.getElementById('actionSteps').classList.add('show');
}
</script>

<!-- Single Chatbase Script (Kept Only Once) -->
<script>
(function(){
    if(!window.chatbase||window.chatbase("getState")!=="initialized"){
        window.chatbase=(...arguments)=>{
            if(!window.chatbase.q){window.chatbase.q=[]}
            window.chatbase.q.push(arguments)
        };
        window.chatbase=new Proxy(window.chatbase,{
            get(target,prop){
                if(prop==="q"){return target.q}
                return(...args)=>target(prop,...args)
            }
        })
    }
    const onLoad=function(){
        const script=document.createElement("script");
        script.src="https://www.chatbase.co/embed.min.js";
        script.id="ws110ZzXAkEnbVsIy9g8d";
        script.domain="www.chatbase.co";
        document.body.appendChild(script)
    };
    if(document.readyState==="complete"){onLoad()}
    else{window.addEventListener("load",onLoad)}
})();
</script>

</body>
</html>